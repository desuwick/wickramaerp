<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wickrama Hardware - Pickup Order System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* Modern Header Design */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            color: #2c3e50;
            padding: 20px 30px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .company-logo {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .company-info h1 {
            font-size: 1.8em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        
        .company-info p {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .manager-status {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: none;
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
        }
        
        .manager-login-btn, .logout-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .manager-login-btn:hover, .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        /* Modern Tab Design */
        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tab {
            flex: 1;
            padding: 18px 15px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
            position: relative;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Beautiful Stats Grid */
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stats-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .live-indicator {
            width: 8px;
            height: 8px;
            background: #11998e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .upload-logo-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);
        }
        
        .upload-logo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .stat-card.recycle-bin::before {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }
        
        .stat-card.expiring::before {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            animation: pulse 2s infinite;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .stat-card.recycle-bin .stat-number {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Form Styling */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 8px;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.3);
        }
        
        .btn-success:hover {
            box-shadow: 0 10px 30px rgba(17, 153, 142, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            box-shadow: 0 6px 20px rgba(255, 165, 2, 0.3);
        }
        
        .btn-warning:hover {
            box-shadow: 0 10px 30px rgba(255, 165, 2, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }
        
        /* Items Table Styling */
        #items-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        #items-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        #items-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        #items-table td {
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        #items-table tbody tr:nth-child(even) td {
            background: rgba(102, 126, 234, 0.05);
        }
        
        /* Order Cards */
        .order-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            margin-bottom: 25px;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .order-number {
            font-size: 1.4em;
            font-weight: 800;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-badge {
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-size: 0.85em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .status-received { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }
        .status-approved { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .status-packed { background: linear-gradient(135deg, #3498db, #2980b9); }
        .status-ready { background: linear-gradient(135deg, #27ae60, #229954); }
        .status-completed { background: linear-gradient(135deg, #2c3e50, #34495e); }
        .status-deleted { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        
        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-group {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        /* Progress Bar */
        .progress-bar {
            margin: 20px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
        }
        
        .progress-track {
            background: rgba(102, 126, 234, 0.1);
            height: 8px;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 8px;
            border-radius: 10px;
            background: linear-gradient(135deg, #11998e, #38ef7d);
            transition: width 0.8s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Approvals Section */
        .approvals {
            margin-top: 20px;
            padding: 20px;
            background: rgba(17, 153, 142, 0.05);
            border-radius: 12px;
            border-left: 4px solid #11998e;
        }
        
        .approval {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
        }
        
        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .search-bar input {
            flex: 2;
            min-width: 250px;
        }
        
        .search-bar select {
            flex: 1;
            min-width: 180px;
        }
        
        /* Alert Messages */
        .alert {
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .alert-success {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1));
            color: #0f5132;
            border-left: 4px solid #11998e;
        }
        
        .alert-error {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(238, 90, 36, 0.1));
            color: #721c24;
            border-left: 4px solid #ff6b6b;
        }
        
        /* Manager Controls */
        .manager-only {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(50%);
        }
        
        .manager-only.enabled {
            opacity: 1;
            cursor: pointer;
            filter: none;
        }
        
        .tab.manager-only:not(.enabled) {
            background: #bdc3c7 !important;
            color: #7f8c8d;
        }
        
        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 25px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal h3 {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .demo-credentials {
            margin-top: 25px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            font-size: 14px;
            text-align: left;
            border-left: 4px solid #667eea;
        }
        
        /* Thermal Printer Label */
        .print-label {
            display: none;
            width: 58mm;
            max-width: 220px;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #000;
            background: white;
            line-height: 1.3;
            border: 1px solid #000;
        }
        
        .print-label.show {
            display: block;
        }
        
        .label-content {
            text-align: center;
        }
        
        .label-header {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .label-divider {
            border-top: 1px dashed #000;
            margin: 4px 0;
        }
        
        .label-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 11px;
        }
        
        .label-footer {
            font-size: 9px;
            margin-top: 4px;
            text-align: center;
            color: #666;
        }
        
        /* Mobile Responsiveness */
        /* Mobile-specific toast positioning */
        @media (max-width: 768px) {
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .toast {
                min-width: auto;
                max-width: none;
                width: 100%;
                transform: translateY(-100px);
            }
            
            .toast.show {
                transform: translateY(0);
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px;
            }
            
            .logo-section {
                justify-content: center;
            }
            
            .company-info h1 {
                font-size: 1.5em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 15px;
                border-radius: 0;
            }
            
            .stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .stat-card {
                padding: 20px 15px;
            }
            
            .stat-number {
                font-size: 2em;
            }
            
            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .order-details {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .search-bar input,
            .search-bar select {
                flex: none;
                width: 100%;
                min-width: auto;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                margin: 5px 0;
            }
            
            .modal-content {
                padding: 30px 20px;
                margin: 20px;
            }
            
            .quick-filters {
                justify-content: center;
                gap: 8px;
            }
            
            .filter-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .company-logo {
                width: 50px;
                height: 50px;
            }
            
            .company-info h1 {
                font-size: 1.3em;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tab-content {
                padding: 20px 15px;
            }
            
            .order-card {
                padding: 15px;
            }
            
            .quick-filters {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-label,
            .print-label * {
                visibility: visible;
            }
            .print-label {
                position: absolute;
                left: 0;
                top: 0;
                width: 58mm;
                padding: 8px;
                border: 1px solid #000;
            }
        }
        
        /* Toast Notification System */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            transform: translateX(450px);
            transition: transform 0.4s ease, opacity 0.4s ease;
            opacity: 0;
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left: 4px solid #11998e;
        }
        
        .toast.error {
            border-left: 4px solid #ff6b6b;
        }
        
        .toast.info {
            border-left: 4px solid #667eea;
        }
        
        .toast-icon {
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .toast.success .toast-icon {
            color: #11998e;
        }
        
        .toast.error .toast-icon {
            color: #ff6b6b;
        }
        
        .toast.info .toast-icon {
            color: #667eea;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2px;
        }
        
        .toast-message {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .toast-close:hover {
            background: rgba(0,0,0,0.05);
            color: #666;
        }
        
        /* Auto-complete System */
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .autocomplete-suggestions.show {
            display: block;
            animation: fadeInUp 0.2s ease;
        }
        
        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.active {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .autocomplete-icon {
            color: #667eea;
            font-size: 0.9em;
        }
        
        .autocomplete-text {
            flex: 1;
        }
        
        .autocomplete-count {
            font-size: 0.8em;
            color: #999;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* Quick Filter Buttons */
        .quick-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .filter-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .filter-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Customer Lookup */
        .customer-lookup {
            position: relative;
            margin-bottom: 20px;
        }
        
        .customer-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .customer-suggestions.show {
            display: block;
        }
        
        .customer-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            transition: background 0.2s ease;
        }
        
        .customer-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .customer-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .customer-phone {
            font-size: 0.9em;
            color: #666;
        }
        
        /* Enhanced Focus States */
        .form-group.focused label {
            color: #667eea;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .form-group input.focused,
        .form-group select.focused,
        .form-group textarea.focused {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Modern Header with Logo -->
        <div class="header">
            <div class="logo-section">
                <img id="company-logo" class="company-logo" src="/uploads/logo.png" alt="Company Logo" style="display: none;">
                <div class="company-info">
                    <h1>üè™ Wickrama Hardware Stores</h1>
                    <p>Advanced Pickup Order Management System</p>
                </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>
            </div>
            
            <div class="header-actions">
                <div class="manager-status" id="manager-status">üë®‚Äçüíº Manager Mode</div>
                <button class="upload-logo-btn manager-only" onclick="handleManagerAction(showLogoUpload)">üì∑ Upload Logo</button>
                <button class="manager-login-btn" id="login-btn" onclick="showLoginModal()">üë®‚Äçüíº Manager Login</button>
                <button class="logout-btn" id="logout-btn" onclick="logout()" style="display:none;">Logout</button>
            </div>
        </div>

        <!-- Modern Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('new-order')">‚ûï New Order</button>
            <button class="tab" onclick="showTab('orders')">üìã Manage Orders</button>
            <button class="tab" onclick="showTab('search')">üîç Search</button>
            <button class="tab manager-only" onclick="handleManagerAction(() => showTab('recycle-bin'))">üóëÔ∏è Recycle Bin</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-header">
                <div class="stats-title">
                    üìä Live Statistics
                    <div class="live-indicator"></div>
                </div>
            </div>
            
            <div class="stats" id="stats-container">
                <!-- Stats will be loaded here -->
            </div>
            
            <h3 style="margin-bottom: 20px; color: #2c3e50; font-weight: 700;">üìã Recent Orders</h3>
            <div id="recent-orders">
                <!-- Recent orders will be loaded here -->
            </div>
        </div>

        <!-- New Order Tab -->
        <div id="new-order" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #2c3e50; font-weight: 700;">‚ûï Create New Order</h2>
            <div id="order-alert"></div>
            <form id="order-form">
                <!-- Customer Lookup -->
                <div class="form-group customer-lookup">
                    <label for="customer-search">üîç Quick Customer Lookup</label>
                    <input type="text" id="customer-search" placeholder="Start typing customer name or phone..." onkeyup="searchCustomers(this.value)">
                    <div id="customer-suggestions" class="customer-suggestions">
                        <!-- Customer suggestions will appear here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customer-name">Customer Name *</label>
                    <input type="text" id="customer-name" placeholder="Enter customer's full name" required>
                </div>
                
                <div class="form-group">
                    <label for="customer-phone">Customer Phone *</label>
                    <input type="tel" id="customer-phone" placeholder="077 123 4567" required>
                </div>
                
                <div class="form-group">
                    <label>Items List *</label>
                    <table id="items-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="autocomplete-container">
                                        <input type="text" name="item-name" placeholder="e.g., 1-inch PVC Pipe" required onkeyup="showItemSuggestions(this)">
                                        <div class="autocomplete-suggestions">
                                            <!-- Item suggestions will appear here -->
                                        </div>
                                    </div>
                                </td>
                                <td><input type="number" name="item-qty" min="1" placeholder="Qty" required></td>
                                <td><button type="button" class="btn btn-danger" onclick="removeItemRow(this)" style="padding: 8px 12px; margin: 0;">‚ùå</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn" style="margin-top: 15px;" onclick="addItemRow()">‚ûï Add Another Item</button>
                </div>
                
                <div class="form-group">
                    <label for="payment-method">Payment Method *</label>
                    <select id="payment-method" required>
                        <option value="">Select payment method</option>
                        <option value="cash">üí∞ Cash on Pickup</option>
                        <option value="prepaid">üí≥ Prepaid</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="staff-name">Staff Name *</label>
                    <input type="text" id="staff-name" placeholder="Enter your name" required>
                </div>
                
                <button type="submit" class="btn btn-success" style="font-size: 18px; padding: 18px 40px;">üöÄ Create Order</button>
            </form>
        </div>

        <!-- Manage Orders Tab -->
        <div id="orders" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #2c3e50; font-weight: 700;">üìã Manage Orders</h2>
            
            <!-- Quick Filters -->
            <div class="quick-filters">
                <button class="filter-btn active" onclick="setQuickFilter('all')" data-filter="all">
                    üìä All Orders
                    <span class="filter-count" id="filter-all-count">0</span>
                </button>
                <button class="filter-btn" onclick="setQuickFilter('today')" data-filter="today">
                    üìÖ Today's Orders
                    <span class="filter-count" id="filter-today-count">0</span>
                </button>
                <button class="filter-btn" onclick="setQuickFilter('ready')" data-filter="ready">
                    üöö Ready for Pickup
                    <span class="filter-count" id="filter-ready-count">0</span>
                </button>
                <button class="filter-btn" onclick="setQuickFilter('urgent')" data-filter="urgent">
                    ‚ö° Needs Attention
                    <span class="filter-count" id="filter-urgent-count">0</span>
                </button>
            </div>
            
            <div class="search-bar">
                <select id="status-filter" onchange="filterOrders()">
                    <option value="all">All Statuses</option>
                    <option value="received">Received</option>
                    <option value="approved">Approved</option>
                    <option value="packed">Packed</option>
                    <option value="ready">Ready for Pickup</option>
                    <option value="completed">Completed</option>
                </select>
                <button class="btn" onclick="loadOrders()">üîÑ Refresh Orders</button>
            </div>
            <div id="orders-container">
                <!-- Orders will be loaded here -->
            </div>
        </div>

        <!-- Search Tab -->
        <div id="search" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #2c3e50; font-weight: 700;">üîç Search Orders</h2>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search by customer name, phone, or order number">
                <select id="search-status-filter">
                    <option value="all">All Statuses</option>
                    <option value="received">Received</option>
                    <option value="approved">Approved</option>
                    <option value="packed">Packed</option>
                    <option value="ready">Ready for Pickup</option>
                    <option value="completed">Completed</option>
                </select>
                <button class="btn" onclick="searchOrders()">üîç Search</button>
            </div>
            <div id="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <!-- Recycle Bin Tab -->
        <div id="recycle-bin" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #2c3e50; font-weight: 700;">üóëÔ∏è Recycle Bin</h2>
            <div class="alert" style="background: rgba(255, 165, 2, 0.1); color: #cc5500; border-left: 4px solid #ffa502;">
                <strong>‚ÑπÔ∏è Auto-Cleanup Policy:</strong> Orders in recycle bin are automatically permanently deleted after 7 days. Data is exported before permanent deletion.
            </div>
            
            <div class="search-bar">
                <div id="recycle-stats" style="flex: 1; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 12px; margin-right: 15px; font-weight: 600;">
                    <strong>Recycle Bin: </strong><span id="recycle-count">0</span> orders | 
                    <strong>Expiring Soon: </strong><span id="expiring-count">0</span> orders
                </div>
                <button class="btn" onclick="loadRecycleBin()">üîÑ Refresh</button>
                <button class="btn btn-danger" onclick="confirmEmptyRecycleBin()">üóëÔ∏è Empty All</button>
            </div>
            
            <div id="recycle-bin-container">
                <!-- Deleted orders will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Manager Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <h3>üîê Manager Login</h3>
            <div id="login-alert"></div>
            <form onsubmit="login(event)">
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button type="submit" class="btn btn-success">üöÄ Login</button>
                <button type="button" class="btn" onclick="closeLoginModal()">Cancel</button>
            </form>
            
            <div class="demo-credentials">
                <strong>üéØ Demo Credentials:</strong><br>
                <strong>Manager:</strong> manager / manager123<br>
                <strong>Supervisor:</strong> supervisor / super123<br><br>
                <small><strong>üÜï Latest Features:</strong><br>
                ‚Ä¢ Beautiful modern dashboard design<br>
                ‚Ä¢ Logo upload functionality<br>
                ‚Ä¢ Enhanced mobile responsiveness<br>
                ‚Ä¢ Professional thermal printer labels</small>
            </div>
        </div>
    </div>

    <!-- Logo Upload Modal -->
    <div class="modal" id="logo-upload-modal">
        <div class="modal-content">
            <h3>üì∑ Upload Company Logo</h3>
            <div id="logo-upload-alert"></div>
            <form id="logo-upload-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="logo-file">Choose Logo File (PNG, JPG) - Max 5MB</label>
                    <input type="file" id="logo-file" name="logo" accept="image/*" required style="padding: 10px;">
                </div>
                <button type="submit" class="btn btn-success">üì§ Upload Logo</button>
                <button type="button" class="btn" onclick="closeLogoUploadModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Enhanced Thermal Printer Label -->
    <div class="print-label" id="print-label">
        <div class="label-content">
            <div class="label-header">WICKRAMA HARDWARE</div>
            <div class="label-divider"></div>
            
            <div class="label-row">
                <strong>ORDER:</strong>
                <span id="label-order-number"></span>
            </div>
            
            <div class="label-row">
                <strong>INVOICE:</strong>
                <span id="label-invoice-number"></span>
            </div>
            
            <div class="label-row">
                <strong>PAYMENT:</strong>
                <span id="label-payment-method"></span>
            </div>
            
            <div class="label-row">
                <strong>CUSTOMER:</strong>
                <span id="label-customer-name"></span>
            </div>
            
            <div class="label-divider"></div>
            <div class="label-footer">
                <div>Generated: <span id="label-timestamp"></span></div>
                <div>Thank you for choosing us!</div>
            </div>
        </div>
    </div>

    <script>
        let currentOrders = [];
        let currentStats = {};
        let currentDeletedOrders = [];
        let recycleBinStats = {};
        let isManagerLoggedIn = false;
        let currentQuickFilter = 'all';
        
        // Auto-complete data
        let commonItems = [];
        let customerHistory = [];

        // Toast Notification System
        function showToast(title, message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;
            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="hideToast('${toastId}')">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto-hide
            setTimeout(() => hideToast(toastId), duration);
        }

        function hideToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }
        }

        // Auto-complete for Items
        function showItemSuggestions(input) {
            const value = input.value.toLowerCase().trim();
            const container = input.parentNode;
            const suggestions = container.querySelector('.autocomplete-suggestions');
            
            if (value.length < 2) {
                suggestions.classList.remove('show');
                return;
            }
            
            // Filter common items
            const filtered = commonItems.filter(item => 
                item.name.toLowerCase().includes(value)
            ).slice(0, 5);
            
            if (filtered.length === 0) {
                suggestions.classList.remove('show');
                return;
            }
            
            suggestions.innerHTML = filtered.map(item => `
                <div class="autocomplete-item" onclick="selectItem('${item.name}', this)">
                    <span class="autocomplete-icon">üì¶</span>
                    <span class="autocomplete-text">${item.name}</span>
                    <span class="autocomplete-count">${item.count}x</span>
                </div>
            `).join('');
            
            suggestions.classList.add('show');
        }

        function selectItem(itemName, element) {
            const input = element.closest('.autocomplete-container').querySelector('input');
            input.value = itemName;
            element.closest('.autocomplete-suggestions').classList.remove('show');
            
            // Focus next field (quantity)
            const qtyInput = input.closest('tr').querySelector('[name="item-qty"]');
            if (qtyInput) qtyInput.focus();
        }

        // Customer Lookup System
        function searchCustomers(query) {
            const suggestions = document.getElementById('customer-suggestions');
            
            if (query.length < 2) {
                suggestions.classList.remove('show');
                return;
            }
            
            // First search from cached customer history
            const filtered = customerHistory.filter(customer => 
                customer.name.toLowerCase().includes(query.toLowerCase()) ||
                customer.phone.includes(query)
            ).slice(0, 5);
            
            if (filtered.length === 0) {
                suggestions.classList.remove('show');
                return;
            }
            
            suggestions.innerHTML = filtered.map(customer => `
                <div class="customer-item" onclick="selectCustomer('${customer.name}', '${customer.phone}')">
                    <div class="customer-name">${customer.name}</div>
                    <div class="customer-phone">${customer.phone}</div>
                </div>
            `).join('');
            
            suggestions.classList.add('show');
        }

        function selectCustomer(name, phone) {
            document.getElementById('customer-name').value = name;
            document.getElementById('customer-phone').value = phone;
            document.getElementById('customer-suggestions').classList.remove('show');
            document.getElementById('customer-search').value = name;
            
            // Focus payment method
            document.getElementById('payment-method').focus();
            showToast('Customer Found', `Auto-filled details for ${name}`, 'info', 2000);
        }

        // Load customer history from server
        async function loadCustomerHistory() {
            try {
                const response = await fetch('/api/customers');
                const customers = await response.json();
                customerHistory = customers;
            } catch (error) {
                console.error('Error loading customer history:', error);
                // Fallback to building from current orders
                buildAutoCompleteData();
            }
        }

        // Quick Filter System
        function setQuickFilter(filter) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            
            currentQuickFilter = filter;
            applyQuickFilter();
        }

        function applyQuickFilter() {
            let filtered = [...currentOrders];
            const today = new Date().toDateString();
            
            switch (currentQuickFilter) {
                case 'today':
                    filtered = filtered.filter(order => 
                        new Date(order.created_at).toDateString() === today
                    );
                    break;
                case 'ready':
                    filtered = filtered.filter(order => order.status === 'ready');
                    break;
                case 'urgent':
                    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
                    filtered = filtered.filter(order => {
                        return (order.status === 'ready' && new Date(order.created_at) < oneHourAgo) ||
                               (order.status === 'received' && order.approvals.length === 0);
                    });
                    break;
                case 'all':
                default:
                    // No filtering
                    break;
            }
            
            displayOrders(filtered);
            updateFilterCounts();
        }

        function updateFilterCounts() {
            const today = new Date().toDateString();
            const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
            
            const counts = {
                all: currentOrders.length,
                today: currentOrders.filter(order => 
                    new Date(order.created_at).toDateString() === today
                ).length,
                ready: currentOrders.filter(order => order.status === 'ready').length,
                urgent: currentOrders.filter(order => 
                    (order.status === 'ready' && new Date(order.created_at) < oneHourAgo) ||
                    (order.status === 'received' && order.approvals.length === 0)
                ).length
            };
            
            Object.keys(counts).forEach(filter => {
                const countElement = document.getElementById(`filter-${filter}-count`);
                if (countElement) {
                    countElement.textContent = counts[filter];
                    countElement.style.display = counts[filter] > 0 ? 'flex' : 'none';
                }
            });
        }

        // Auto-focus System
        function setupAutoFocus() {
            // Focus customer search when new order tab is opened
            const newOrderTab = document.querySelector('[onclick*="new-order"]');
            newOrderTab.addEventListener('click', () => {
                setTimeout(() => {
                    const customerSearch = document.getElementById('customer-search');
                    if (customerSearch) customerSearch.focus();
                }, 100);
            });
            
            // Setup focus events for form fields
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('focus', function() {
                    this.closest('.form-group')?.classList.add('focused');
                    this.classList.add('focused');
                });
                
                field.addEventListener('blur', function() {
                    this.closest('.form-group')?.classList.remove('focused');
                    this.classList.remove('focused');
                });
            });
        }

        // Build auto-complete data from existing orders
        function buildAutoCompleteData() {
            const itemCounts = {};
            const customers = {};
            
            currentOrders.forEach(order => {
                // Build customer history
                if (!customers[order.customer_phone]) {
                    customers[order.customer_phone] = {
                        name: order.customer_name,
                        phone: order.customer_phone
                    };
                }
                
                // Build item frequency
                if (order.items) {
                    const items = order.items.split(',').map(item => item.trim());
                    items.forEach(item => {
                        const cleanItem = item.replace(/^\d+x\s*/, '').trim();
                        if (cleanItem) {
                            itemCounts[cleanItem] = (itemCounts[cleanItem] || 0) + 1;
                        }
                    });
                }
            });
            
            // Convert to arrays
            commonItems = Object.entries(itemCounts)
                .map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 20); // Top 20 items
            
            customerHistory = Object.values(customers);
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.autocomplete-container')) {
                document.querySelectorAll('.autocomplete-suggestions').forEach(suggestions => {
                    suggestions.classList.remove('show');
                });
            }
            
            if (!e.target.closest('.customer-lookup')) {
                document.getElementById('customer-suggestions')?.classList.remove('show');
            }
        });

        // Check if already logged in and load logo
        window.onload = () => {
            const savedManager = localStorage.getItem('managerLoggedIn');
            const savedAdmin = localStorage.getItem('isAdmin') === 'true';
            
            if (savedManager === 'true') {
                isManagerLoggedIn = true;
                setManagerMode(true);
            }
            
            loadLogo();
            loadDashboard();
        };

        // Load company logo
        async function loadLogo() {
            try {
                const response = await fetch('/api/logo');
                const result = await response.json();
                
                if (result.success && result.hasLogo) {
                    const logoImg = document.getElementById('company-logo');
                    logoImg.src = result.logoUrl + '?t=' + new Date().getTime(); // Cache busting
                    logoImg.style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading logo:', error);
            }
        }

        // Show logo upload modal
        function showLogoUpload() {
            document.getElementById('logo-upload-modal').classList.add('show');
        }

        // Close logo upload modal
        function closeLogoUploadModal() {
            document.getElementById('logo-upload-modal').classList.remove('show');
            document.getElementById('logo-upload-alert').innerHTML = '';
        }

        // Handle logo upload
        document.getElementById('logo-upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const logoFile = document.getElementById('logo-file').files[0];
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            if (!logoFile) {
                showAlert('logo-upload-alert', 'Please select a logo file', 'error');
                return;
            }
            
            // Validate file size (5MB limit)
            if (logoFile.size > 5 * 1024 * 1024) {
                showAlert('logo-upload-alert', 'Logo file must be less than 5MB', 'error');
                return;
            }
            
            formData.append('logo', logoFile);
            formData.append('staffName', managerName);
            
            try {
                const response = await fetch('/api/upload-logo', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('logo-upload-alert', 'Logo uploaded successfully!', 'success');
                    loadLogo(); // Reload the logo
                    setTimeout(() => {
                        closeLogoUploadModal();
                    }, 2000);
                } else {
                    showAlert('logo-upload-alert', result.error || 'Error uploading logo', 'error');
                }
            } catch (error) {
                showAlert('logo-upload-alert', 'Network error occurred', 'error');
            }
        });

        // Show login modal
        function showLoginModal() {
            document.getElementById('login-modal').classList.add('show');
        }

        // Close login modal
        function closeLoginModal() {
            document.getElementById('login-modal').classList.remove('show');
            document.getElementById('login-alert').innerHTML = '';
        }

        // Manager login
        async function login(event) {
            event.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            // Simple client-side authentication (in production, use server-side)
            const validCredentials = {
                'manager': 'manager123',
                'supervisor': 'super123'
            };
            
            if (validCredentials[username] === password) {
                setManagerMode(true);
                localStorage.setItem('managerLoggedIn', 'true');
                localStorage.setItem('managerName', username);
                closeLoginModal();
                showAlert('login-alert', '', 'success'); // Clear any errors
            } else {
                showAlert('login-alert', 'Invalid credentials', 'error');
            }
        }

        // Logout
        function logout() {
            setManagerMode(false);
            localStorage.removeItem('managerLoggedIn');
            localStorage.removeItem('managerName');
        }

        // Set manager mode
        function setManagerMode(enabled) {
            isManagerLoggedIn = enabled;
            
            if (enabled) {
                document.getElementById('manager-status').style.display = 'block';
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'block';
                
                // Enable all manager functions
                document.querySelectorAll('.manager-only').forEach(el => {
                    el.classList.add('enabled');
                    el.style.opacity = '1';
                    el.style.cursor = 'pointer';
                    el.style.filter = 'none';
                });
            } else {
                document.getElementById('manager-status').style.display = 'none';
                document.getElementById('login-btn').style.display = 'block';
                document.getElementById('logout-btn').style.display = 'none';
                
                // Disable all manager functions
                document.querySelectorAll('.manager-only').forEach(el => {
                    el.classList.remove('enabled');
                    el.style.opacity = '0.6';
                    el.style.cursor = 'not-allowed';
                    el.style.filter = 'grayscale(50%)';
                });
                
                // If currently viewing recycle bin, switch to dashboard
                if (document.getElementById('recycle-bin').classList.contains('active')) {
                    showTab('dashboard');
                    // Also update the tab active state
                    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('.tab[onclick*="dashboard"]').classList.add('active');
                }
            }
        }

        // Handle manager actions
        function handleManagerAction(action) {
            if (!isManagerLoggedIn) {
                showLoginModal();
                return;
            }
            action();
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'recycle-bin') {
                loadRecycleBin();
            }
        }

        // Add new item row
        function addItemRow() {
            const table = document.querySelector('#items-table tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" name="item-name" placeholder="Enter item name" required></td>
                <td><input type="number" name="item-qty" min="1" placeholder="Qty" required></td>
                <td><button type="button" class="btn btn-danger" onclick="removeItemRow(this)" style="padding: 8px 12px; margin: 0;">‚ùå</button></td>
            `;
            table.appendChild(row);
        }

        // Remove item row
        function removeItemRow(btn) {
            const table = document.querySelector('#items-table tbody');
            if (table.children.length > 1) {
                btn.closest('tr').remove();
            } else {
                alert('At least one item is required');
            }
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                const statsResponse = await fetch('/api/stats');
                currentStats = await statsResponse.json();
                
                const recycleBinStatsResponse = await fetch('/api/recycle-bin/stats');
                recycleBinStats = await recycleBinStatsResponse.json();
                
                displayStats();
                
                const ordersResponse = await fetch('/api/orders');
                const orders = await ordersResponse.json();
                displayRecentOrders(orders.slice(-5).reverse());
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Display enhanced stats
        function displayStats() {
            const statsContainer = document.getElementById('stats-container');
            const recycleBinClass = recycleBinStats.expiringSoon > 0 ? 'recycle-bin expiring' : 'recycle-bin';
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${currentStats.total || 0}</div>
                    <div class="stat-label">Active Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.today || 0}</div>
                    <div class="stat-label">Today's Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.received || 0}</div>
                    <div class="stat-label">Received</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.approved || 0}</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.packed || 0}</div>
                    <div class="stat-label">Packed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.ready || 0}</div>
                    <div class="stat-label">Ready</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${currentStats.completed || 0}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card ${recycleBinClass}">
                    <div class="stat-number">${recycleBinStats.total || 0}</div>
                    <div class="stat-label">Recycle Bin</div>
                </div>
            `;
        }

        // Display recent orders
        function displayRecentOrders(orders) {
            const container = document.getElementById('recent-orders');
            if (orders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.05); border-radius: 15px; border: 2px dashed #667eea;">
                        <h3>üìã No Recent Orders</h3>
                        <p>Recent orders will appear here once created.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = orders.map(order => createOrderCard(order)).join('');
        }

        // Create order form submission
        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const itemRows = document.querySelectorAll('#items-table tbody tr');
            const items = Array.from(itemRows).map(row => {
                const name = row.querySelector('[name="item-name"]').value.trim();
                const qty = row.querySelector('[name="item-qty"]').value.trim();
                return `${qty}x ${name}`;
            }).join(', ');

            const formData = {
                customerName: document.getElementById('customer-name').value,
                customerPhone: document.getElementById('customer-phone').value,
                items,
                paymentMethod: document.getElementById('payment-method').value,
                staffName: document.getElementById('staff-name').value
            };

            try {
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('order-alert', `üéâ Order created successfully! Order Number: ${result.order_number}`, 'success');
                    document.getElementById('order-form').reset();
                    // Reset to one item row
                    const tbody = document.querySelector('#items-table tbody');
                    tbody.innerHTML = `
                        <tr>
                            <td><input type="text" name="item-name" placeholder="e.g., 1-inch PVC Pipe" required></td>
                            <td><input type="number" name="item-qty" min="1" placeholder="Qty" required></td>
                            <td><button type="button" class="btn btn-danger" onclick="removeItemRow(this)" style="padding: 8px 12px; margin: 0;">‚ùå</button></td>
                        </tr>
                    `;
                } else {
                    showAlert('order-alert', '‚ùå Error creating order', 'error');
                }
            } catch (error) {
                showAlert('order-alert', '‚ùå Network error occurred', 'error');
            }
        });

        // Load orders
        async function loadOrders() {
            try {
                const response = await fetch('/api/orders');
                currentOrders = await response.json();
                filterOrders();
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // Filter orders by status
        function filterOrders() {
            const statusFilter = document.getElementById('status-filter').value;
            let filteredOrders = currentOrders;
            
            if (statusFilter !== 'all') {
                filteredOrders = currentOrders.filter(order => order.status === statusFilter);
            }
            
            displayOrders(filteredOrders);
        }

        // Display orders
        function displayOrders(orders) {
            const container = document.getElementById('orders-container');
            if (orders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.05); border-radius: 15px; border: 2px dashed #667eea;">
                        <h3>üìã No Orders Found</h3>
                        <p>Orders matching your criteria will appear here.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = orders.map(order => createOrderCard(order, true)).join('');
        }

        // Create enhanced order card HTML
        function createOrderCard(order, showActions = false) {
            const statusClass = `status-${order.status.replace(' ', '-')}`;
            const canApprove = order.status === 'received' && order.approvals.length < 3;
            const canPack = order.status === 'approved';
            const canMarkReady = order.status === 'packed';
            const canComplete = order.status === 'ready';

            const progressBar = `
                <div class="progress-bar">
                    <strong>Approval Progress: ${order.approvals.length}/3</strong>
                    <div class="progress-track">
                        <div class="progress-fill" style="width: ${(order.approvals.length / 3) * 100}%"></div>
                    </div>
                </div>
            `;

            const approvalsBlock = order.approvals.length > 0 ? `
                <div class="approvals">
                    <strong>‚úÖ Approvals (${order.approvals.length}/3):</strong>
                    ${order.approvals.map(approval => `
                        <div class="approval">
                            <span><strong>${approval.staff}</strong></span>
                            <span>${new Date(approval.timestamp).toLocaleString()}</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            const managerActions = showActions ? `
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.1);">
                    ${canApprove ? `
                        <button class="btn btn-warning manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => approveOrder('${order.order_number}'))">
                            ‚úÖ Approve (${order.approvals.length}/3)
                        </button>
                    ` : ''}
                    
                    ${(order.status === 'received' || order.status === 'approved') ? `
                        <button class="btn manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => updateInvoiceNumber('${order.order_number}'))">
                            üìÑ Set Invoice Number
                        </button>
                    ` : ''}
                    
                    ${canPack ? `
                        <button class="btn btn-success manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => updateOrderStatus('${order.order_number}', 'packed'))">
                            üì¶ Mark as Packed
                        </button>
                    ` : ''}
                    
                    ${canMarkReady ? `
                        <button class="btn btn-success manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => updateOrderStatus('${order.order_number}', 'ready'))">
                            ‚úÖ Mark as Ready
                        </button>
                    ` : ''}
                    
                    ${canComplete ? `
                        <button class="btn manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => updateOrderStatus('${order.order_number}', 'completed'))">
                            üèÅ Mark as Completed
                        </button>
                    ` : ''}
                    
                    ${(order.status === 'packed' || order.status === 'ready') ? `
                        <button class="btn" onclick="printLabel('${order.order_number}')">
                            üñ®Ô∏è Print Thermal Label
                        </button>
                    ` : ''}
                    
                    ${showActions ? `
                        <button class="btn btn-danger manager-only ${isManagerLoggedIn ? 'enabled' : ''}" onclick="handleManagerAction(() => deleteOrder('${order.order_number}'))">
                            üóëÔ∏è Move to Recycle Bin
                        </button>
                    ` : ''}
                </div>
            ` : '';

            return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-number">${order.order_number}</div>
                        <div class="status-badge ${statusClass}">${order.status.toUpperCase()}</div>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-group">
                            <strong>üë§ Customer Info</strong><br>
                            <strong>Name:</strong> ${order.customer_name}<br>
                            <strong>Phone:</strong> ${order.customer_phone}
                        </div>
                        <div class="detail-group">
                            <strong>üí≥ Order Details</strong><br>
                            <strong>Payment:</strong> ${order.payment_method}<br>
                            <strong>Invoice:</strong> ${order.invoice_number || 'Not set'}
                        </div>
                        <div class="detail-group">
                            <strong>üìÖ Timeline</strong><br>
                            <strong>Created:</strong> ${new Date(order.created_at).toLocaleDateString()}<br>
                            <strong>By:</strong> ${order.created_by}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0; padding: 15px; background: rgba(102, 126, 234, 0.05); border-radius: 12px; border-left: 4px solid #667eea;">
                        <strong>üì¶ Items:</strong> ${order.items}
                    </div>
                    
                    ${progressBar}
                    ${approvalsBlock}
                    ${managerActions}
                </div>
            `;
        }

        // Approve order (no name prompt for manager actions)
        async function approveOrder(orderNumber) {
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/orders/${orderNumber}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`‚úÖ Approval added successfully! (${result.approvals}/3 approvals)`);
                    loadOrders();
                    loadDashboard();
                } else {
                    alert('‚ùå ' + (result.error || 'Error adding approval'));
                }
            } catch (error) {
                alert('‚ùå Network error occurred');
            }
        }

        // Update order status (no name prompt for manager actions)
        async function updateOrderStatus(orderNumber, status) {
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/orders/${orderNumber}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status, staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`‚úÖ Order status updated to: ${status.toUpperCase()}`);
                    loadOrders();
                    loadDashboard();
                } else {
                    alert('‚ùå ' + (result.error || 'Error updating status'));
                }
            } catch (error) {
                alert('‚ùå Network error occurred');
            }
        }

        // Update invoice number (no name prompt for manager actions)
        async function updateInvoiceNumber(orderNumber) {
            const invoiceNumber = prompt('üìÑ Enter invoice number from ERP:');
            if (!invoiceNumber) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const order = currentOrders.find(o => o.order_number === orderNumber);
                if (!order) return;
                
                const response = await fetch(`/api/orders/${orderNumber}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        status: order.status,
                        staffName: managerName,
                        invoiceNumber 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Invoice number updated successfully!');
                    loadOrders();
                } else {
                    alert('‚ùå ' + (result.error || 'Error updating invoice number'));
                }
            } catch (error) {
                alert('‚ùå Network error occurred');
            }
        }

        // Delete order (move to recycle bin)
        async function deleteOrder(orderNumber) {
            if (!confirm('üóëÔ∏è Move this order to recycle bin?\n\nIt will be automatically permanently deleted after 7 days.')) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/orders/${orderNumber}`, { 
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Order moved to recycle bin successfully!\n\n' + result.message);
                    loadOrders();
                    loadDashboard();
                } else {
                    alert('‚ùå Failed to move order to recycle bin: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('‚ùå Network error while moving order to recycle bin');
            }
        }

        // Search orders
        async function searchOrders() {
            const query = document.getElementById('search-input').value;
            const status = document.getElementById('search-status-filter').value;
            
            try {
                const params = new URLSearchParams();
                if (query) params.append('q', query);
                if (status !== 'all') params.append('status', status);
                
                const response = await fetch(`/api/search?${params}`);
                const orders = await response.json();
                
                document.getElementById('search-results').innerHTML = 
                    orders.length > 0 ? orders.map(order => createOrderCard(order, true)).join('') :
                    `<div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.05); border-radius: 15px; border: 2px dashed #667eea;">
                        <h3>üîç No Results Found</h3>
                        <p>Try adjusting your search criteria.</p>
                    </div>`;
            } catch (error) {
                console.error('Error searching orders:', error);
            }
        }

        // Enhanced print label with better thermal printer support
        async function printLabel(orderNumber) {
            try {
                const response = await fetch(`/api/orders/${orderNumber}`);
                const order = await response.json();
                
                if (!order.invoice_number) {
                    alert('‚ö†Ô∏è Please set invoice number before printing label');
                    return;
                }
                
                // Fill enhanced label data
                document.getElementById('label-order-number').textContent = order.order_number;
                document.getElementById('label-customer-name').textContent = order.customer_name;
                document.getElementById('label-invoice-number').textContent = order.invoice_number;
                document.getElementById('label-payment-method').textContent = order.payment_method.toUpperCase();
                document.getElementById('label-timestamp').textContent = new Date().toLocaleString();
                
                // Show and print label
                document.getElementById('print-label').classList.add('show');
                setTimeout(() => {
                    window.print();
                    document.getElementById('print-label').classList.remove('show');
                }, 500);
                
            } catch (error) {
                alert('‚ùå Error loading order for label');
            }
        }

        // Load recycle bin (implementation from previous version)
        async function loadRecycleBin() {
            try {
                const [ordersResponse, statsResponse] = await Promise.all([
                    fetch('/api/deleted-orders'),
                    fetch('/api/recycle-bin/stats')
                ]);
                
                currentDeletedOrders = await ordersResponse.json();
                const stats = await statsResponse.json();
                
                updateRecycleBinStats(stats);
                displayDeletedOrders(currentDeletedOrders);
            } catch (error) {
                console.error('Error loading recycle bin:', error);
                document.getElementById('recycle-bin-container').innerHTML = '<p>‚ùå Error loading recycle bin</p>';
            }
        }

        // Update recycle bin statistics
        function updateRecycleBinStats(stats) {
            document.getElementById('recycle-count').textContent = stats.total || 0;
            document.getElementById('expiring-count').textContent = stats.expiringSoon || 0;
            
            // Highlight if orders are expiring soon
            const expiringElement = document.getElementById('expiring-count');
            if (stats.expiringSoon > 0) {
                expiringElement.style.color = '#e74c3c';
                expiringElement.style.fontWeight = 'bold';
            } else {
                expiringElement.style.color = '';
                expiringElement.style.fontWeight = '';
            }
        }

        // Display deleted orders
        function displayDeletedOrders(deletedOrders) {
            const container = document.getElementById('recycle-bin-container');
            
            if (deletedOrders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.05); border-radius: 15px; border: 2px dashed #667eea;">
                        <h3>üóëÔ∏è Recycle Bin is Empty</h3>
                        <p>Deleted orders will appear here and be automatically cleaned up after 7 days.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = deletedOrders.map(order => createDeletedOrderCard(order)).join('');
        }

        // Create deleted order card
        function createDeletedOrderCard(order) {
            const deletedAt = new Date(order.deleted_at);
            const now = new Date();
            const daysOld = Math.floor((now - deletedAt) / (1000 * 60 * 60 * 24));
            const daysRemaining = Math.max(0, 7 - daysOld);
            
            const urgentStyle = daysRemaining <= 2 ? 'border-left: 4px solid #e74c3c;' : '';
            
            return `
                <div class="order-card" style="${urgentStyle}">
                    <div class="order-header">
                        <div class="order-number">${order.order_number}</div>
                        <div class="status-badge status-deleted">DELETED</div>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-group">
                            <strong>üë§ Customer Info</strong><br>
                            <strong>Name:</strong> ${order.customer_name}<br>
                            <strong>Phone:</strong> ${order.customer_phone}
                        </div>
                        <div class="detail-group">
                            <strong>üìã Order Info</strong><br>
                            <strong>Original Status:</strong> ${order.original_status || 'Unknown'}<br>
                            <strong>Payment:</strong> ${order.payment_method}
                        </div>
                        <div class="detail-group">
                            <strong>üóëÔ∏è Deletion Info</strong><br>
                            <strong>Deleted:</strong> ${deletedAt.toLocaleDateString()}<br>
                            <strong>By:</strong> ${order.deleted_by}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0; padding: 15px; background: rgba(102, 126, 234, 0.05); border-radius: 12px; border-left: 4px solid #667eea;">
                        <strong>üì¶ Items:</strong> ${order.items}
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: ${daysRemaining <= 2 ? 'rgba(255, 107, 107, 0.1)' : 'rgba(255, 165, 2, 0.1)'}; border-radius: 12px; border-left: 4px solid ${daysRemaining <= 2 ? '#ff6b6b' : '#ffa502'};">
                        <strong>‚è∞ Auto-deletion in: ${daysRemaining} days</strong>
                        ${daysRemaining <= 2 ? '<br><span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è Will be permanently deleted soon!</span>' : ''}
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.1);">
                        <button class="btn btn-success" onclick="restoreOrder('${order.order_number}')">
                            ‚ôªÔ∏è Restore Order
                        </button>
                        <button class="btn btn-danger" onclick="permanentlyDeleteOrder('${order.order_number}')">
                            üóëÔ∏è Delete Forever
                        </button>
                    </div>
                </div>
            `;
        }

        // Restore order from recycle bin
        async function restoreOrder(orderNumber) {
            if (!confirm('‚ôªÔ∏è Restore this order back to active orders?')) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/orders/${orderNumber}/restore`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Order restored successfully!');
                    loadRecycleBin();
                    loadDashboard();
                } else {
                    alert('‚ùå Failed to restore order: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Restore error:', error);
                alert('‚ùå Network error while restoring order');
            }
        }

        // Permanently delete order
        async function permanentlyDeleteOrder(orderNumber) {
            if (!confirm('‚ö†Ô∏è PERMANENTLY DELETE this order?\n\n‚Ä¢ This action CANNOT be undone\n‚Ä¢ Order data will be exported for records\n‚Ä¢ Order will be removed from all systems\n\nAre you absolutely sure?')) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/deleted-orders/${orderNumber}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`‚úÖ Order permanently deleted!\n\n${result.message}\n\nExported to: ${result.exportedTo || 'Export failed'}`);
                    loadRecycleBin();
                    loadDashboard();
                } else {
                    alert('‚ùå Failed to permanently delete order: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Permanent delete error:', error);
                alert('‚ùå Network error while permanently deleting order');
            }
        }

        // Confirm empty all recycle bin
        async function confirmEmptyRecycleBin() {
            if (currentDeletedOrders.length === 0) {
                alert('Recycle bin is already empty');
                return;
            }
            
            if (!confirm(`‚ö†Ô∏è EMPTY ENTIRE RECYCLE BIN?\n\n‚Ä¢ This will permanently delete ${currentDeletedOrders.length} orders\n‚Ä¢ All order data will be exported for records\n‚Ä¢ This action CANNOT be undone\n\nAre you absolutely sure?`)) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            let successCount = 0;
            let failCount = 0;
            
            for (const order of currentDeletedOrders) {
                try {
                    const response = await fetch(`/api/deleted-orders/${order.order_number}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ staffName: managerName })
                    });
                    
                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                } catch (error) {
                    failCount++;
                }
            }
            
            alert(`‚úÖ Recycle bin emptied!\n\nSuccessfully deleted: ${successCount} orders\n${failCount > 0 ? `‚ùå Failed: ${failCount} orders` : ''}\n\nAll data has been exported for records.`);
            
            loadRecycleBin();
            loadDashboard();
        }

        // Show alert message
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            container.innerHTML = message ? `<div class="alert ${alertClass}">${message}</div>` : '';
            
            if (message) {
                setTimeout(() => {
                    container.innerHTML = '';
                }, 5000);
            }
        }

        // Load orders
        async function loadOrders() {
            try {
                const response = await fetch('/api/orders');
                currentOrders = await response.json();
                buildAutoCompleteData();
                updateFilterCounts();
                applyQuickFilter();
                showToast('Refreshed', 'Orders updated successfully', 'success', 2000);
            } catch (error) {
                console.error('Error loading orders:', error);
                showToast('Error', 'Failed to load orders', 'error');
            }
        }

        // Filter orders by status (enhanced)
        function filterOrders() {
            const statusFilter = document.getElementById('status-filter').value;
            let filtered = [...currentOrders];
            
            // Apply quick filter first
            switch (currentQuickFilter) {
                case 'today':
                    const today = new Date().toDateString();
                    filtered = filtered.filter(order => 
                        new Date(order.created_at).toDateString() === today
                    );
                    break;
                case 'ready':
                    filtered = filtered.filter(order => order.status === 'ready');
                    break;
                case 'urgent':
                    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
                    filtered = filtered.filter(order => {
                        return (order.status === 'ready' && new Date(order.created_at) < oneHourAgo) ||
                               (order.status === 'received' && order.approvals.length === 0);
                    });
                    break;
            }
            
            // Then apply status filter
            if (statusFilter !== 'all') {
                filtered = filtered.filter(order => order.status === statusFilter);
            }
            
            displayOrders(filtered);
        }

        // Search orders
        async function searchOrders() {
            const query = document.getElementById('search-input').value;
            const status = document.getElementById('search-status-filter').value;
            
            try {
                const params = new URLSearchParams();
                if (query) params.append('q', query);
                if (status !== 'all') params.append('status', status);
                
                const response = await fetch(`/api/search?${params}`);
                const orders = await response.json();
                
                const resultContainer = document.getElementById('search-results');
                if (orders.length > 0) {
                    resultContainer.innerHTML = orders.map(order => createOrderCard(order, true)).join('');
                    showToast('Search Results', `Found ${orders.length} matching orders`, 'info', 3000);
                } else {
                    resultContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.05); border-radius: 15px; border: 2px dashed #667eea;">
                            <h3>üîç No Results Found</h3>
                            <p>Try adjusting your search criteria.</p>
                        </div>
                    `;
                    showToast('No Results', 'No orders match your search criteria', 'info', 3000);
                }
            } catch (error) {
                console.error('Error searching orders:', error);
                showToast('Search Error', 'Failed to search orders', 'error');
            }
        }

        // Enhanced print label with better thermal printer support
        async function printLabel(orderNumber) {
            try {
                const response = await fetch(`/api/orders/${orderNumber}`);
                const order = await response.json();
                
                if (!order.invoice_number) {
                    showToast('Invoice Required', 'Please set invoice number before printing label', 'warning');
                    return;
                }
                
                // Fill enhanced label data
                document.getElementById('label-order-number').textContent = order.order_number;
                document.getElementById('label-customer-name').textContent = order.customer_name;
                document.getElementById('label-invoice-number').textContent = order.invoice_number;
                document.getElementById('label-payment-method').textContent = order.payment_method.toUpperCase();
                document.getElementById('label-timestamp').textContent = new Date().toLocaleString();
                
                // Show and print label
                document.getElementById('print-label').classList.add('show');
                showToast('Printing Label', `Label ready for order ${orderNumber}`, 'info', 2000);
                
                setTimeout(() => {
                    window.print();
                    document.getElementById('print-label').classList.remove('show');
                }, 500);
                
            } catch (error) {
                showToast('Print Error', 'Failed to load order for label', 'error');
            }
        }

        // Load recycle bin (enhanced with toast notifications)
        async function loadRecycleBin() {
            try {
                const [ordersResponse, statsResponse] = await Promise.all([
                    fetch('/api/deleted-orders'),
                    fetch('/api/recycle-bin/stats')
                ]);
                
                currentDeletedOrders = await ordersResponse.json();
                const stats = await statsResponse.json();
                
                updateRecycleBinStats(stats);
                displayDeletedOrders(currentDeletedOrders);
                
                if (stats.expiringSoon > 0) {
                    showToast('Attention Required', `${stats.expiringSoon} orders expiring soon in recycle bin`, 'warning', 5000);
                }
            } catch (error) {
                console.error('Error loading recycle bin:', error);
                showToast('Error', 'Failed to load recycle bin', 'error');
                document.getElementById('recycle-bin-container').innerHTML = '<p>‚ùå Error loading recycle bin</p>';
            }
        }

        // Restore order from recycle bin
        async function restoreOrder(orderNumber) {
            if (!confirm('‚ôªÔ∏è Restore this order back to active orders?')) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/orders/${orderNumber}/restore`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Order Restored', `Order ${orderNumber} restored successfully!`, 'success');
                    loadRecycleBin();
                    loadDashboard();
                } else {
                    showToast('Restore Failed', result.error || 'Could not restore order', 'error');
                }
            } catch (error) {
                console.error('Restore error:', error);
                showToast('Network Error', 'Please check your connection and try again', 'error');
            }
        }

        // Permanently delete order
        async function permanentlyDeleteOrder(orderNumber) {
            if (!confirm('‚ö†Ô∏è PERMANENTLY DELETE this order?\n\n‚Ä¢ This action CANNOT be undone\n‚Ä¢ Order data will be exported for records\n‚Ä¢ Order will be removed from all systems\n\nAre you absolutely sure?')) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            try {
                const response = await fetch(`/api/deleted-orders/${orderNumber}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staffName: managerName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Permanently Deleted', `Order permanently deleted. Exported to: ${result.exportedTo || 'Export failed'}`, 'info', 6000);
                    loadRecycleBin();
                    loadDashboard();
                } else {
                    showToast('Delete Failed', result.error || 'Could not permanently delete order', 'error');
                }
            } catch (error) {
                console.error('Permanent delete error:', error);
                showToast('Network Error', 'Please check your connection and try again', 'error');
            }
        }

        // Confirm empty all recycle bin
        async function confirmEmptyRecycleBin() {
            if (currentDeletedOrders.length === 0) {
                showToast('Already Empty', 'Recycle bin is already empty', 'info');
                return;
            }
            
            if (!confirm(`‚ö†Ô∏è EMPTY ENTIRE RECYCLE BIN?\n\n‚Ä¢ This will permanently delete ${currentDeletedOrders.length} orders\n‚Ä¢ All order data will be exported for records\n‚Ä¢ This action CANNOT be undone\n\nAre you absolutely sure?`)) return;
            
            const managerName = localStorage.getItem('managerName') || 'manager';
            let successCount = 0;
            let failCount = 0;
            
            showToast('Processing', 'Emptying recycle bin...', 'info', 10000);
            
            for (const order of currentDeletedOrders) {
                try {
                    const response = await fetch(`/api/deleted-orders/${order.order_number}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ staffName: managerName })
                    });
                    
                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                } catch (error) {
                    failCount++;
                }
            }
            
            const message = `Successfully deleted: ${successCount} orders${failCount > 0 ? `. Failed: ${failCount} orders` : ''}. All data exported for records.`;
            showToast('Recycle Bin Emptied', message, 'success', 6000);
            
            loadRecycleBin();
            loadDashboard();
        }

        // Logo upload functionality (enhanced)
        document.getElementById('logo-upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const logoFile = document.getElementById('logo-file').files[0];
            const managerName = localStorage.getItem('managerName') || 'manager';
            
            if (!logoFile) {
                showToast('File Required', 'Please select a logo file', 'warning');
                return;
            }
            
            // Validate file size (5MB limit)
            if (logoFile.size > 5 * 1024 * 1024) {
                showToast('File Too Large', 'Logo file must be less than 5MB', 'error');
                return;
            }
            
            // Validate file type
            if (!logoFile.type.startsWith('image/')) {
                showToast('Invalid File', 'Please select an image file', 'error');
                return;
            }
            
            formData.append('logo', logoFile);
            formData.append('staffName', managerName);
            
            try {
                showToast('Uploading', 'Uploading your logo...', 'info', 3000);
                
                const response = await fetch('/api/upload-logo', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Logo Uploaded', 'Company logo updated successfully!', 'success');
                    loadLogo(); // Reload the logo
                    setTimeout(() => {
                        closeLogoUploadModal();
                    }, 2000);
                } else {
                    showToast('Upload Failed', result.error || 'Error uploading logo', 'error');
                }
            } catch (error) {
                showToast('Upload Error', 'Network error occurred during upload', 'error');
            }
        });

        // Enhanced login with toast notifications
        async function login(event) {
            event.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            // Simple client-side authentication (in production, use server-side)
            const validCredentials = {
                'manager': 'manager123',
                'supervisor': 'super123'
            };
            
            if (validCredentials[username] === password) {
                setManagerMode(true);
                localStorage.setItem('managerLoggedIn', 'true');
                localStorage.setItem('managerName', username);
                closeLoginModal();
                showToast('Login Successful', `Welcome ${username}! Manager features enabled.`, 'success', 4000);
            } else {
                showToast('Login Failed', 'Invalid username or password', 'error');
            }
        }

        // Show alert message (legacy function - replaced by toast)
        function showAlert(containerId, message, type) {
            // Convert to toast notification instead
            const title = type === 'success' ? 'Success' : 'Error';
            showToast(title, message, type);
        }

        // Auto-refresh with toast notification
        setInterval(() => {
            if (document.getElementById('dashboard').classList.contains('active')) {
                loadDashboard();
            }
        }, 30000);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const loginModal = document.getElementById('login-modal');
            const logoModal = document.getElementById('logo-upload-modal');
            
            if (event.target == loginModal) {
                closeLoginModal();
            }
            if (event.target == logoModal) {
                closeLogoUploadModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Only work when not typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'n': // Ctrl+N for new order
                        e.preventDefault();
                        document.querySelector('[onclick*="new-order"]').click();
                        showToast('Shortcut Used', 'Switched to New Order tab', 'info', 2000);
                        break;
                    case 'f': // Ctrl+F for search
                        e.preventDefault();
                        document.querySelector('[onclick*="search"]').click();
                        setTimeout(() => document.getElementById('search-input').focus(), 100);
                        showToast('Shortcut Used', 'Switched to Search tab', 'info', 2000);
                        break;
                    case 'r': // Ctrl+R for refresh
                        e.preventDefault();
                        if (document.getElementById('orders').classList.contains('active')) {
                            loadOrders();
                        } else if (document.getElementById('dashboard').classList.contains('active')) {
                            loadDashboard();
                        } else if (document.getElementById('recycle-bin')?.classList.contains('active')) {
                            loadRecycleBin();
                        }
                        break;
                }
            }
        });

        // Initialize tooltips and help text
        function initializeHelpSystem() {
            // Add keyboard shortcut hints
            const helpHint = document.createElement('div');
            helpHint.style.cssText = `
                position: fixed;
                bottom: 10px;
                left: 10px;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                z-index: 1000;
                opacity: 0.7;
                transition: opacity 0.3s ease;
            `;
            helpHint.innerHTML = 'üí° Shortcuts: Ctrl+N (New Order) | Ctrl+F (Search) | Ctrl+R (Refresh)';
            document.body.appendChild(helpHint);
            
            // Hide after 10 seconds
            setTimeout(() => {
                helpHint.style.opacity = '0';
                setTimeout(() => document.body.removeChild(helpHint), 300);
            }, 10000);
        }

        // Initialize help system after page load
        setTimeout(initializeHelpSystem, 3000);

        // Welcome message for first-time users
        if (!localStorage.getItem('welcomed')) {
            setTimeout(() => {
                showToast('Welcome!', 'Welcome to Wickrama Hardware Pickup System. Use Ctrl+N for new orders!', 'info', 6000);
                localStorage.setItem('welcomed', 'true');
            }, 2000);
        }
    </script>
</body>
</html>